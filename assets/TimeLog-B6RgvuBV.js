import{d as r,e as h,f as A,a as n,b as o,n as g,g as C,l as y,v as U,F as D,i as k,m as N,h as x,o as i,t as d}from"./vendor-_e7UF12I.js";import{_ as V,d as O}from"./index-C3ZWiLvT.js";import{Q as F}from"./appwrite-DjGSp9AC.js";const j={class:"time-log-container"},B={class:"time-log-sections"},E={class:"filters"},M={class:"filter-group"},P=["value"],Q={key:0,class:"filter-group"},q={key:1,class:"filter-group"},z=["value"],R={class:"time-log-content"},G={key:0},H={key:1},J={key:2},K={class:"time-log-list"},X={class:"log-user"},Y={class:"log-status"},Z={class:"log-timestamp"},ee={__name:"TimeLog",setup(te){const w=r([]),p=r(!0),l=r("daily"),_=r([]),c=r(""),m=r(new Date().toISOString().slice(0,10)),v=r(""),b=r([]),S=r({});h(()=>{L();const s=new Date;for(let e=0;e<4;e++){const t=new Date(s);t.setDate(t.getDate()-t.getDay()-e*7);const a=new Date(t);a.setDate(a.getDate()+6),b.value.push(`${t.toLocaleDateString()} - ${a.toLocaleDateString()}`)}});const L=async()=>{p.value=!0;try{const s=await O.listDocuments("684639c3000fbbd515ea","68463a24000779b721a1",[F.orderDesc("timestamp")]);w.value=s.documents;const e=[...new Set(s.documents.map(t=>t.user_Id))];_.value=e,await T(e)}catch(s){console.error("Failed to fetch time logs:",s)}finally{p.value=!1}},T=async s=>{try{const e=await O.listDocuments("684639c3000fbbd515ea","68465330002c380c2975"),t={};e.documents.forEach(a=>{a.user_Id&&(t[a.user_Id]=a.displayName||"")}),S.value=t,console.log("Fetched profiles:",t)}catch(e){console.error("Failed to fetch user profiles:",e)}},W=s=>{const e=S.value[s];return e?`${e} (${s})`:s},f=A(()=>{let s=w.value;if(c.value&&(s=s.filter(e=>e.user_Id===c.value)),l.value==="daily")s=s.filter(e=>new Date(e.timestamp).toISOString().slice(0,10)===m.value);else if(l.value==="weekly"){if(v.value){const[e]=v.value.split(" - "),t=new Date(e),a=new Date(t);a.setDate(a.getDate()+6),s=s.filter(u=>{const I=new Date(u.timestamp);return I>=t&&I<=a})}}else l.value==="custom"&&(s=s.filter(e=>new Date(e.timestamp).toISOString().slice(0,10)===m.value));return s}),$=()=>{const s=f.value.map(u=>({user:u.user_Id,status:u.Status,timestamp:new Date(u.timestamp).toLocaleString()})),e="data:text/csv;charset=utf-8,"+["User,Status,Timestamp"].join(",")+`
`+s.map(u=>Object.values(u).join(",")).join(`
`),t=encodeURI(e),a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download","time_logs.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)};return h(L),(s,e)=>(i(),n("div",j,[e[11]||(e[11]=o("h2",{class:"section-title"},"Time Log",-1)),o("div",B,[o("button",{onClick:e[0]||(e[0]=t=>l.value="daily"),class:g({active:l.value==="daily"})},"Daily",2),o("button",{onClick:e[1]||(e[1]=t=>l.value="weekly"),class:g({active:l.value==="weekly"})},"Weekly",2),o("button",{onClick:e[2]||(e[2]=t=>l.value="custom"),class:g({active:l.value==="custom"})},"Custom",2)]),o("div",E,[o("div",M,[e[7]||(e[7]=o("label",{for:"agent-select"},"Agent:",-1)),y(o("select",{id:"agent-select","onUpdate:modelValue":e[3]||(e[3]=t=>c.value=t),class:"filter-dropdown"},[e[6]||(e[6]=o("option",{value:""},"All Agents",-1)),(i(!0),n(D,null,k(_.value,t=>(i(),n("option",{key:t,value:t},d(t),9,P))),128))],512),[[U,c.value]])]),l.value==="daily"||l.value==="custom"?(i(),n("div",Q,[e[8]||(e[8]=o("label",{for:"date-select"},"Date:",-1)),y(o("input",{id:"date-select",type:"date","onUpdate:modelValue":e[4]||(e[4]=t=>m.value=t),class:"filter-dropdown"},null,512),[[N,m.value]])])):C("",!0),l.value==="weekly"?(i(),n("div",q,[e[9]||(e[9]=o("label",{for:"week-select"},"Week:",-1)),y(o("select",{id:"week-select","onUpdate:modelValue":e[5]||(e[5]=t=>v.value=t),class:"filter-dropdown"},[(i(!0),n(D,null,k(b.value,t=>(i(),n("option",{key:t,value:t},d(t),9,z))),128))],512),[[U,v.value]])])):C("",!0),o("button",{onClick:$,class:"download-btn"},e[10]||(e[10]=[o("i",{class:"download-icon"},"â†“",-1),x(" Download Logs ")]))]),o("div",R,[p.value?(i(),n("div",G,"Loading time logs...")):f.value.length===0?(i(),n("div",H,"No time logs found.")):(i(),n("div",J,[o("ul",K,[(i(!0),n(D,null,k(f.value,t=>(i(),n("li",{key:t.$id,class:"time-log-item"},[o("span",X,"User: "+d(W(t.user_Id)),1),o("span",Y,d(t.Status),1),o("span",Z,d(new Date(t.timestamp).toLocaleString()),1)]))),128))])]))])]))}},le=V(ee,[["__scopeId","data-v-3a33d49b"]]);export{le as default};
//# sourceMappingURL=TimeLog-B6RgvuBV.js.map
